

<style>


.tabs input {
  position: absolute;
  opacity: 0;
  z-index: -1;
}

/* Accordion styles */
.tabs {
    margin: 10px 0;
}

.tab {
  width: 100%;
  color: white;
  overflow: hidden;
  border-bottom: solid 1px #63707c;
}
.tab-label {
    display: flex;
    justify-content: space-between;
    padding: 10px;
    background: #1e416d;
    /* font-weight: bold; */
    cursor: pointer;
}
.tab-label:hover {
  background: #1a252f;
}
.tab-label::after {
  content: "❯";
  width: 1em;
  height: 1em;
  text-align: center;
  transition: all 0.35s;
}
.tab.children > .tab-label::after {
    opacity: 1 !important;
}
.tab-content {
  max-height: 0;
  padding: 0 1em;
  color: #2c3e50;
  background: white;
  transition: all 0.5s;
}

.tab.children input:checked + .tab-label {
  background: #1a252f;
}
.tab.children input:checked + .tab-label::after {
  transform: rotate(90deg);
}
.tab.children input:checked ~ .tab-content {
    max-height: 100vh;
    padding: 8px;
}

.sub-item {
    padding: 8px 10px 8px 16px;
    border-bottom: 1px solid #ddd;
}

.sub-item:not(.active):hover {
    background-color: #f2f2f2;
    cursor:pointer;
}

.sub-item.active {
    background-color: #ddd;
}

</style>
            
<div data-pagina="categorias" class="row h100">

    <div class="left-panel">
        
        <div class="layer">
            <!-- <div id="resultado-list" class="products-list"></div> -->

            <button class="page-button" onClick="resetCache()">Reset Cache</button>

            <div id="lst-categorias" class="tabs"></div>
        </div>

    </div>

    <div class="right-panel">


        <div class="layer">
            
            <div class="main-form">

                <div class="form-row" data-label="ID"><div class="form-input"><input type="text" data-field="id" style="width: 150px;" readonly /></div></div>
                <div class="form-row" data-label="Titulo"><input type="text" data-field="title" readonly/></div>
                <div class="form-row" data-label="Descripción"><textarea type="text" data-field="description" /></textarea></div>
                <div class="form-row" data-label="Keywords"><textarea data-field="keywords" /></textarea></div>
                <div class="form-row" data-label="Producto TOP"><input type="text" data-field="first_product" /></div>
                <div class="form-row" data-label="Laborario TOP"><input type="text" data-field="lab_top" /></div>
                <br><br>
                <button class="page-button" onClick="saveCat()">Guardar</button>

            </div>

        </div>

    </div>

</div>

<script>



    $parent = $("[data-pagina='categorias']")

    $parent.find(".simple-tags").each(function() {
        Tags(this);
    })

    setLabels($parent.find(".main-form"))
    
    let cats_ds = new DATASET({
        endpoint: "getcats",
        set_endpoint: "crud",
        api_model: "cats"
    })

    async function init() {

        const res = await cats_ds.get()

        console.log(res)
        renderTab(res.cats.categorias)

        //if((res = await API.POST.search("[cats]vitaminas-minerales-y-suplementos/vitaminas", "08001")).error)  searchCallback(0)
        //else searchCallback(res.data.products.length, res.data.products, res.data.brand, res.data.str, res.data.cat_id, res.data.sub_id)

    }
    init()
       

    function renderTab(items) {

        let s = ""

        const getSubs = (cat) => {
            let s = `<div class="sub-item" style="padding-left:10px" data-id="${cat.id}"><b>${cat.id} - ${cat.title}</b></div>`
            IMP.forEach(cat.subs, (item, key) => {
                s += `<div class="sub-item" data-id="${key}">${key} - ${item.title}</div>`
            })
            return s
        }

        IMP.forEach(items, (item, index) => {
            s += 
`<div id="tab${item.id}" class="tab children" data-id="${item.id}">
<input type="checkbox" id="chk${item.id}">
<label class="tab-label" for="chk${item.id}">${item.id} - ${item.title}</label>
<div class="tab-content">${getSubs(item)}</div>
</div>`
            
        })

        $("#lst-categorias").html(s)

        $(".sub-item").off("click").on("click", async e => {
            const $elem = $(e.currentTarget)
            $(".sub-item").removeClass("active")
            $elem.addClass("active")
            await setCat($elem.data("id"))
        })

    }

    let current_id = null

    async function setCat(id) {
        const res = await cats_ds.get({fields: {id}})

        if(!res.error) {
            current_id = id
            $parent.find("[data-field='id']").val(res.id)
            $parent.find("[data-field='title']").val(res.title)
            $parent.find("[data-field='description']").val(res.description)
            $parent.find("[data-field='keywords']").val(res.keywords)
            $parent.find("[data-field='lab_top']").val(res.lab_top)
        }
        
    }

    async function saveCat() {

        if(!current_id) return 
        const res = await cats_ds.set({default: {fields: {
                description: $parent.find("[data-field='description']").val(),
                keywords: $parent.find("[data-field='keywords']").val(),
                lab_top: $parent.find("[data-field='lab_top']").val()
            }, filter: {id: current_id}
        }})
        //console.log(res.title, $parent.find("[data-field='title']"))
        
        //$parent.find("[data-field='title']").val(res.title)
        //$parent.find("[data-field='description']").val(res.description)
        //$parent.find("[data-field='keywords']").val(res.keywords)
    }

    async function resetCache() {
        const res = await _fetch("resetcache", {elem: "ofertas"})
    }
    

</script>