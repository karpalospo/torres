
            
<div data-pagina="productos" class="row h100">

    <div class="left-panel">
        
        <div class="tool-row">

        </div>

        <div class="layer">
            <div id="resultado-list" class="products-list"></div>
        </div>

    </div>

    <div class="right-panel">


        <div id="tab-products">
        
            <div class="tab-menu">
                <div>Buscador</div>
                <div>Info BÃ¡sica</div>
                <div>Info Avanzada</div>
            </div>
        
            <div class="tab-container">
                
                <div class="tab-info" style="display:none">
                
                </div>
                <div class="tab-info" style="display:none">

                    <div class="tool-row center">
                        <button class="page-button" data-action="new">Nuevo Producto</button>
                        <button class="page-button" data-action="save">Guardar</button>

                    </div>

                    <div class="layer">

                        <div class="main-form">

                            <div class="form-row" data-label="ID">
                                <div class="form-input">
                                    <input type="text" data-field="id" style="width: 150px;" readonly />
                                </div>
                            </div>

                            <div class="form-row" data-label="Estado">
                                <div class="form-input">
                                    <select data-field="estado">
                                        <option value="0">Inactivo</option>
                                        <option value="1">Activo</option>
                                    </select>
                                </div>
                            </div>

                            <div class="form-row" data-label="Grupo">
                                <div class="form-input">
                                    <select data-field="grupo"></select>
                                </div>
                            </div>
   
                            <div class="form-row" data-label="Titulo">
                                <input type="text" data-field="titulo" />
                            </div>
                            
                            <div class="form-row" data-label="Imagen Web">
                                <input type="text" data-field="imagen" />
                            </div>

                            <div class="form-row" data-label="Imagen Mobile">
                                <input type="text" data-field="imagen2" />
                            </div>

                            <div class="form-row" data-label="Imagen Popup">
                                <input type="text" data-field="imagen3" />
                            </div>

                            <div class="form-row" data-label="Fecha">
                                <div class="form-input">
                                    <input type="date" data-field="fecha_inicio" placeholder="AAAA-MM-DD" pattern="[0-9]{4}-[0-9]{2}-[0-9]{2}" style="width: 150px;" />
                                    &nbsp; - &nbsp;
                                    <input type="date" data-field="fecha_fin" placeholder="AAAA-MM-DD" pattern="[0-9]{4}-[0-9]{2}-[0-9]{2}"  style="width: 150px;" />
                                </div>
                            </div>


                        </div>

                    </div>

                </div>


                <div class="tab-info" style="display:none">

                  
                </div>
    
            </div>
        
        </div>

    </div>


</div>

<script>


    bnInitTabs($("#tab-products"), 0, tabChanged2);

    $parent = $("[data-pagina='productos']")

    $parent.find(".simple-tags").each(function() {
        Tags(this);
    })

    setLabels($parent.find(".main-form"))
    

    productos_ds = new DATASET({
        api_model: "productos",
        scheme: {
            id: null,
            active: null, 
            name: null,
            webname: null,
            provider: null,
            brand: null,
            description: null,
            group1_id: null,
            group2_id: null,
            group3_id: null,
        },
        sort: {id: "DESC"},
    })
/*
        "id",
		"name",
		"webname",
		"active",
		"provider",
		"brand",
		"description",
		"group1_id",
		"group2_id",
		"group3_id",
		"ean",
		"keywords",
		"prescription",
		"identification",
		"imagen",
		"format",
		"presentation",
		"content",
		"score",
		"views",
		"clicks",
		"score2",
		"version"
*/
    async function init() {

        //productos = await productos_ds.get({paging:{start: 0, count: 50}})
        if((res = await API.POST.search("[cats]vitaminas-minerales-y-suplementos/vitaminas", "08001")).error)  searchCallback(0)
        else searchCallback(res.data.products.length, res.data.products, res.data.brand, res.data.str, res.data.cat_id, res.data.sub_id)

    }
    init()
       
    searchCallback = async (success, products, brand, search_str, cat_id, sub_id) => {

        let $resultado_list = $("#resultado-list")

        if(success > 0) {
            products = await renderProducts($resultado_list, products)
            //if(search_str) $result_title.html(`<strong>${products.stock.length}</strong> resultado${products.stock.length == 1 ? "" : "s"} para <strong>${search_str}</strong>`)
            //else $result_title.html(`<strong>${products.stock.length}</strong> productos`)
        } else if(success == 0) {
            //$(".result-title").html(`No se encontraron productos para <b>${str}</b>`)
            //$resultado_list.html("")
        }
    }

    function tabChanged2(index) {
        //if(index == 1) loadBanners()
    }


    function renderProducts($target, products, options = {}) {

        continueAnim = false

        $target.html("")

        let rango, page = 0, page_items = 50

        rango = [page * page_items, (page + 1) * page_items]

        IMP.forEach(products, (item, index) => {
            if(index >= rango[0] && index < rango[1]) $target.append(renderProductItem(item, item.noStock, options.lazy_img))
        })

        /*$target.off("click").on("click", ".product-item", function(e) {
            e.preventDefault();
            console.log($target)
            productClick($(e.currentTarget), $(e.target), $target)
        })*/

        //$target.data("page", {page, page_items})

       // return $target
    }


    function renderProductItem(item, type, lazy_img = false) {


        switch(type) {

            case "loading":
                return `
        <div class="product-item" style="pointer-events:none">
        <div class="item">
            <div class="image"></div>
            <div class="info">
                <div class="placeholder"></div>
                <div class="placeholder"></div>
                <div class="placeholder"></div>
            </div>
        </div>
        </div>`


            default:
                if(!item || !item.id) console.log(item)
                return `
        <div class="product-item" data-id="${item.id}">
        <div class="item">
        <div class="image">
            <img src="https://www.droguerialaeconomia.com/economia/site/img/${item.id}.png" alt="" />
        </div>

        <div class="info">
            <span class="titulo">${item.nombre}</span>
            <span class="titulo">${item.marca}</span>
            <span class="titulo">${item.cat}</span>
            <span class="titulo">${item.sub}</span>
        </div>
        </div>
        </div>`

        }
    }


</script>